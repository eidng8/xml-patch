branches:
  only:
    - master
    - dev
os:
  - linux
language: node_js
node_js:
  - 12
addons:
  chrome: stable
cache:
  directories:
    - node_modules
install:
  - npm install

before_script:
  - curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 > ./cc-test-reporter
  - chmod +x ./cc-test-reporter
  - ./cc-test-reporter before-build
script:
  - if [[ ${BUNDLE_ANALYZER_TOKEN} != "" ]]; then npm install --no-save @bundle-analyzer/webpack-plugin; fi
  - npm run test:cover
  - npm install coveralls
  - cat ./coverage/lcov.info | coveralls
after_script:
  - ./cc-test-reporter after-build --exit-code $TRAVIS_TEST_RESULT

before_deploy:
  - export TRAVIS_TAG=$(node -p "require('./package.json').version")
  - echo ${TRAVIS_TAG}
  - 'if [[ ${TAGGED} != 1 ]]; then git tag ${TRAVIS_TAG} && export TAGGED=1; fi'
  - 'if [[ ! -e lib ]]; then npm run build && export PACKAGE=$(npm pack --silent); fi'
deploy:
  - provider: releases
    skip_cleanup: true
    file: $PACKAGE
    api_key:
      secure: ddcX6LWvpcOjF8aiZgTN6QSmN8SIJidSC7K2MO34f1YwL4JSbFSl77QczhhLQt5N/Iplu3cFfCXuxBeDicxROv3LDNWrJTG94bNClO8MR1fyBxftCuFlVSfOLllpGhkkQ4LcBFdZjv6leGJuTcPWRds1Fa2xN7aJMxmVwoCXirkPxtHrMZbiCTyVh8ODquMcdtLJV8+KRMO+t+c6JNWoSK8a26sKY71KI31kj4Ffb2ape3aZ2fLJCpONMWktPJCrRuvUApGTzthVmYa/DcRbkAVna3XGMUKmkTD6DdT4YXnwgV+YLe4plCbwqqE7lGTwpIg7CzKSKUlAX9JtKtyNHGAfG8/GK4RqLRpRsFDw+kNmXuwrhrHZHeomCnf/ZpLq2ihK1GGpGyV5uVoLajoizBAlD+/d0vWYjNj5A0sAj8953/kevl/Kp+tgkE+pLOcjd9h+PzYTQVfqCPH0QPK0KgGH1w66ZCrHCyw1aaRF788MyDRNfKxGF+T6H37o6fp96lkVrq+qkTXZnKd8af9y0T4jxEfWoWhFHGj1G/MXkfb1Yeg2A3AM51o0JB0m9X2neEle7GE6mtdS34eX8+BbGbfFeZFam/Sut4+oosNy/WBWrNyMZXKDz1tTPVF44mhUAu9gglwbQixknAvpB+KYBtsD7/bzinGd8cCtxb+m7o0=
    on:
      repo: eidng8/xml-patch
      branch: master
      #tags: true
      condition: ${TRAVIS_EVENT_TYPE} == push
  - provider: npm
    skip_cleanup: true
    email: cheung.jackey@gmail.com
    api_key:
      secure: vLLc2vmkvfBh5KU+3rsuctrnMJTMICYsk6CAISZ+H3eMBwsSF2gQiUZMADcCbmnOaYbb388CcLuncrjrdQ6ECV6f4fzcu/Y8pZObp83y1klafscJYOSlvhHjIq4CvrDJ6/8LU7H3pE8EeixezLXvCOxfrmA19PZxh5g+RQY/OFASVgM7mMx9Rpm3z9PD+wl7OH9aa+WZ7TK8Xw9pB6FeBtLSD6Z3Ufs9XL5WWhipWoD13X63KF6yXI8ppJh/Swz29pt8wjGwIrS1r9FbuYT6NFulYX2zJfhoQs/GojtS/hV3L6QaITpBL50RrtlgRgup4nEn4saMK9bbuFDSjfpqhS11U6XyFZ8TdSoUUY9OA8MyemhC182GNsShhpRTsOoEuow3AvcIbxPWwfdWb7L6HSNOdxom33Vot4RZ77nVgBldGp683tHDE9i2Ye2k0rAuxszGDw/kfOyldYVU2Jk1/ZI3iA06+p9MLl1jMcTZrglGJM6KDYZtQqOTPusgJjd8+OWrVmTA9ellZ5cVvlgcZpEAyK9fRdBFro53q3zyrDu6LV3RaICjRawl/Y1XKs3jhkGM1SoilTQJw0q6v6qFHkO+TlHuKveGYDG2OCeIQQroyy/Rj78hCeCEiKP4w1idcuPiTUxv6FJ7Zw/c/we5yVLV66tot9oK1d31QH9f9io=
    on:
      repo: eidng8/xml-patch
      branch: master
      condition: ${TRAVIS_EVENT_TYPE} == push
      #tags: true
