branches:
  only:
    - master
    - dev
os:
  - linux
language: node_js
node_js:
  - 12
addons:
  chrome: stable
cache:
  directories:
    - node_modules
install:
  - npm install
script:
  - npm run test:cover
  - npm install coveralls
  - cat ./coverage/lcov.info | coveralls

before_deploy:
  - export TRAVIS_TAG=${TRAVIS_TAG:-$(node -p "require('./package.json').version")-$(date +'%Y.%m.%d')-$(git log --format=%h -1)}
  - echo ${TRAVIS_TAG}
  - "if [[ ${TAGGED} != 1 ]]; then git tag ${TRAVIS_TAG} && export TAGGED=1; fi"
  - "if [[ ! -e lib ]]; then npm run build && export PACKAGE=$(npm pack --silent); fi"
deploy:
  - provider: releases
    skip_cleanup: true
    file: $PACKAGE
    api_key:
      secure: ddcX6LWvpcOjF8aiZgTN6QSmN8SIJidSC7K2MO34f1YwL4JSbFSl77QczhhLQt5N/Iplu3cFfCXuxBeDicxROv3LDNWrJTG94bNClO8MR1fyBxftCuFlVSfOLllpGhkkQ4LcBFdZjv6leGJuTcPWRds1Fa2xN7aJMxmVwoCXirkPxtHrMZbiCTyVh8ODquMcdtLJV8+KRMO+t+c6JNWoSK8a26sKY71KI31kj4Ffb2ape3aZ2fLJCpONMWktPJCrRuvUApGTzthVmYa/DcRbkAVna3XGMUKmkTD6DdT4YXnwgV+YLe4plCbwqqE7lGTwpIg7CzKSKUlAX9JtKtyNHGAfG8/GK4RqLRpRsFDw+kNmXuwrhrHZHeomCnf/ZpLq2ihK1GGpGyV5uVoLajoizBAlD+/d0vWYjNj5A0sAj8953/kevl/Kp+tgkE+pLOcjd9h+PzYTQVfqCPH0QPK0KgGH1w66ZCrHCyw1aaRF788MyDRNfKxGF+T6H37o6fp96lkVrq+qkTXZnKd8af9y0T4jxEfWoWhFHGj1G/MXkfb1Yeg2A3AM51o0JB0m9X2neEle7GE6mtdS34eX8+BbGbfFeZFam/Sut4+oosNy/WBWrNyMZXKDz1tTPVF44mhUAu9gglwbQixknAvpB+KYBtsD7/bzinGd8cCtxb+m7o0=
    on:
      repo: eidng8/xml-patch
      branch: master
      #tags: true
      condition: ${TRAVIS_EVENT_TYPE} == push
  - provider: npm
    skip_cleanup: true
    email: cheung.jackey@gmail.com
    api_key:
      secure: dlxpPqcMNWn56tqFF31XkegUB0h1ViPHVtwYJGLubRG666U36ESbJ0+QNs/dxeDf5Az+kyALikLuNdPEg/BhP/kfNVRpfVPkFran51FtMY2yNTc+bdnShlTOMc6FZw18JCvPmB3XJyS/0Zne7oyI8hStTO/XcTDzvCit9c72D0xvLZX3byTBqmcmw22XEAx/gukTns75t+GGFe13nd27LZQQ6lmdOKx2CVgDYxn0+VgaTY0IkP0jktej5OiN8lXGuAerajv0X99ZcQ340sUH86+NK+aA/iFCkiXVWElrt+57gzCXU/7jI6GNgjS7+OZC/QH761nZ8lE3sHZQexqgZjNo4AL5vsZYiL2dL7r0wXAd2GUKMD/C5QwKQYy8VRw+D8Nq2NoqVwgp6iawjh6P+lh4OHgCcAOOfAg5HP9H6ErUbSNdzXqI6F+SzPrA40H7NYmxp3Xq8atWRP59Dn2M8k2/+dItoUtHvgvLfe1NpX+LvHyDwwcE+VQYHSi6UylQsUea+AlRda66F601t1sOde8xA3ZZzsdlYl6JWJVSYnEKuAF8qLBWe6aWSkVlFyNpELU7A5ea/76BTyhHWX1M9ZDbEh2hruDATpVlv1UfJXtu7KCXXvTxjsp4YmUo5G1UxaZxu3i43ZYV+kg4ILo1hV/CiTvvRLoFjskWc8vfrY8=
    on:
      repo: eidng8/xml-patch
      branch: master
      condition: ${TRAVIS_EVENT_TYPE} == push
      #tags: true
